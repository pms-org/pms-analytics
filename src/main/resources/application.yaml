# spring:
#   application:
#     name: analytics

#   docker:
#     compose:
#       enabled: false

#   datasource:
#     url: ${DB_URL}
#     username: ${DB_USERNAME}
#     password: ${DB_PASSWORD}
#     driver-class-name: org.postgresql.Driver

#   jpa:
#     hibernate:
#       ddl-auto: update
#     show-sql: false
#     properties:
#       hibernate.jdbc.time_zone: UTC

#   kafka:
#     bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:kafka:29092}
#     properties:
#       schema.registry.url: ${SCHEMA_REGISTRY_URL:http://schema-registry:8081}
#     consumer:
#       group-id: demo-group
#       enable-auto-commit: false

#   sql:
#     init:
#       platform: postgres

#   data:
#     redis:
#       timeout: 10s
#       lettuce:
#         shutdown-timeout: 2s
#       sentinel:
#         master: mymaster
#         nodes:
#           - sentinel-1:26379
#           - sentinel-2:26379
#           - sentinel-3:26379

# finnhub:
#   api:
#     key: ${API_KEY}

# app:
#   consumer-topic: ${KAFKA_CONSUMER_TOPIC}
#   producer-topic: ${KAFKA_PRODUCER_TOPIC}

# server:
#   port: 8082

# management:
#   endpoints:
#     web:
#       exposure:
#         include: health,info

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE}

  application:
    name: analytics

  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate.jdbc.time_zone: UTC

  data:
    redis:
      timeout: ${SPRING_REDIS_TIMEOUT}
      lettuce:
        shutdown-timeout: ${SPRING_REDIS_SHUTDOWN_TIMEOUT}
      sentinel:
        master: ${SPRING_REDIS_SENTINEL_MASTER}
        nodes: ${SPRING_REDIS_SENTINEL_NODES}
  kafka:
    bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS}
    properties:
      schema.registry.url: ${SPRING_KAFKA_SCHEMA_REGISTRY_URL}
    consumer:
      group-id: ${KAFKA_CONSUMER_GROUP_ID}
      enable-auto-commit: false
    producer:
      properties:
        delivery.timeout.ms: ${KAFKA_SEND_TIMEOUT_MS}

server:
  port: ${SERVER_PORT}

# ==============================
# External APIs
# ==============================
finnhub:
  api:
    key: ${FINNHUB_API_KEY}
    base-url: ${FINNHUB_API_BASE_URL}

# ==============================
# Application Kafka Topics
# ==============================
app:
  kafka:
    consumer-topic: ${APP_KAFKA_CONSUMER_TOPIC}
    producer-topic: ${APP_KAFKA_PRODUCER_TOPIC}
  redis:
    price-key: ${SPRING_REDIS_PRICE_KEY}
    transaction-key: ${SPRING_REDIS_TRANSACTION_KEY}

# ==============================
# Scheduling
# ==============================
scheduler:
  portfolio-value:
    cron: ${PORTFOLIO_VALUE_CRON}
    timezone: ${PORTFOLIO_VALUE_TIMEZONE}
  price-refresh:
    delay-ms: ${PRICE_REFRESH_DELAY_MS}

# ==============================
# Outbox Dispatcher
# ==============================
outbox:
  delay:
    system-failure-ms: ${OUTBOX_SYSTEM_FAILURE_DELAY_MS}
    empty-ms: ${OUTBOX_EMPTY_DELAY_MS}
    exception-ms: ${OUTBOX_EXCEPTION_DELAY_MS}
    retry-attempts: ${OUTBOX_RETRY_ATTEMPTS}

# ==============================
# Database Health Monitor
# ==============================
db:
  health:
    retry-ms: ${DB_HEALTH_CHECK_RETRY_MS}

# ==============================
# Risk Calculation
# ==============================
risk:
  decimal-scale: ${RISK_DECIMAL_SCALE}
  math-precision: ${RISK_MATH_PRECISION}

# ==============================
# WebSocket
# ==============================
websocket:
  topics:
    position-update: ${WS_TOPIC_POSITION_UPDATE}
    unrealized-pnl: ${WS_TOPIC_UNREALIZED_PNL}

# ==============================
# CORS
# ==============================
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS}
  allowed-methods: ${CORS_ALLOWED_METHODS}

# ==============================
# Actuator
# ==============================
management:
  endpoints:
    web:
      exposure:
        include: health,info
